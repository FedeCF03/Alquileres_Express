@page "/cantidadDeAlquileres"
@rendermode InteractiveServer
@inject NavigationManager NavigationManager
@using BlazorDateRangePicker
@inject CasoDeUsoListarInmuebles CasoDeUsoListarInmuebles

<body>
    <div class="revenue-dashboard">
        <div class="control-panel">
            <div class="filter-controls">
                <div class="date-filter-wrapper">
                    <div class="filter-label">
                        <i class="fas fa-calendar-range"></i>
                        <span>Seleccionar rango de fechas</span>
                    </div>
                    <div class="date-picker-section">
                        <div class="date-picker-container">
                            <div class="date-fields">
                                <div class="date-field">
                                    <label>Comienzo</label>
                                    <div class="date-value">@(StartDate?.ToString("dd/M/yyyy") ?? "Seleccionar")</div>
                                </div>
                                <div class="date-separator"></div>
                                    <div class="date-field">
                                        <label>Fin</label>
                                        <div class="date-value">@(EndDate?.ToString("dd/M/yyyy") ?? "Seleccionar")</div>
                                    </div>
                                <DateRangePicker StartDatePlaceholder="Comienzo" EndDatePlaceholder="Fin"
                                @bind-StartDate="StartDate" @bind-EndDate="EndDate"
                                class="hidden-picker"
                                placeholder="Select dates..." OnRangeSelect="Filtrar" OnCancel="Cancelar"/>
                            </div>   
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="data-section">
            <div class="section-header">
                <div class="section-title">
                    <i class="fas fa-table"></i>
                    <h3>Registro de cantidad de alquileres</h3>
                </div>
            </div>
            
            <div class="table-wrapper">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th class="date-column">
                                <div class="column-header">
                                    <i class="fas fa-calendar-day"></i>
                                    <span>Nombre</span>
                                </div>
                            </th>
                            <th class="amount-column">
                                <div class="column-header">
                                    <i class="fas fa-money-bill-wave"></i>
                                    <span>Cantidad de veces alquilado</span>
                                </div>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        @for (int i = 0; i < inmuebles.Count; i++)
                        {
                            <tr>
                                <td>@inmuebles[i].Nombre</td>
                                <td>@cantAlquileres[i]</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</body>

@code{
    DateTimeOffset? StartDate { get; set; } 
    DateTimeOffset? EndDate { get; set; } 

    private List<Inmueble> inmuebles = new List<Inmueble>();
    private List<int> cantAlquileres = new List<int>();

    protected override void OnParametersSet()
    {
        inmuebles = CasoDeUsoListarInmuebles.ListarTodos();
        foreach(var inmueble in inmuebles){
            cantAlquileres.Add(inmueble!.Alquileres!.Count);
        }
    }


    private void Filtrar()
    {
        DateTime fecha1 = StartDate?.UtcDateTime ?? DateTime.MinValue;
        DateTime fecha2 = EndDate?.UtcDateTime ?? DateTime.MinValue;
        for(var i = 0; i < inmuebles.Count; i++)
        {
            cantAlquileres[i] = 0; 
            foreach(var alquiler in inmuebles[i].Alquileres)
            {
                if(alquiler.FechaDeCreacion >= fecha1 && alquiler.FechaDeCreacion <= fecha2)
                {
                    cantAlquileres[i]++;
                }
            }
        }
        StateHasChanged();
    }


    private void Cancelar()
    {
        StartDate = null;
        EndDate = null;
        inmuebles.Clear();
        cantAlquileres.Clear();
        inmuebles = CasoDeUsoListarInmuebles.ListarDisponibles();
        foreach(var inmueble in inmuebles){
            cantAlquileres.Add(inmueble.Alquileres.Count);
        }
        StateHasChanged();
    }

}

<style>
    .property-rating i {
        font-size: 1rem;
    }

    .property-rating .text-secondary {
        font-size: 0.9rem;
    }

    .promedio-numero {
        font-size: 1.25rem;
        /* o probá con 1.3rem si querés más presencia */
        font-weight: 600;
        color: #343a40;
        /* o el color que combine con tu estética */
    }

    .hidden-picker {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
        cursor: pointer;
    }
    body {
     background-image: linear-gradient(to right, rgb(222, 42, 42) , rgb(151, 37, 19)) !important;   /*esto es para el color del fondo y que no se ponga blanco  */
}
</style>