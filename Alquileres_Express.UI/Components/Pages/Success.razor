@page "/success"
@inject NavigationManager Navigation
@using Microsoft.AspNetCore.WebUtilities
@using Alquileres_Express.Aplicacion.Servicios;
@inject ServicioVerificarPago servicioVerificarPago

@code {

    public string Status { get; set; } = "";

    public string PreferenceId { get; set; } = "";

    protected override void OnInitialized()
    {
        var uri = Navigation.ToAbsoluteUri(Navigation.Uri);
        var query = QueryHelpers.ParseQuery(uri.Query);
        Status = query.TryGetValue("status", out var val4) ? val4.ToString() : "";
        PreferenceId = query.TryGetValue("preference_id", out var val8) ? val8.ToString() : "";
        if (string.IsNullOrEmpty(Status) || string.IsNullOrEmpty(PreferenceId) || Status != "approved")
        {
            Navigation.NavigateTo($"/?mensaje=Pago rechazado o no encontrado");
        }
        else
        {
            bool aprobado = servicioVerificarPago.VerificarPago(PreferenceId);
            Navigation.NavigateTo($"/?mensaje=Pago aprobado");
        }


    }
}