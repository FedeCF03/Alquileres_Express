@page "/ListarLlaves/{idAlquiler:int}/{idCliente:int}"
@inject CasoDeUsoListarLlaves CasoDeUsoListarLlaves
@inject CasoDeUsoBuscarClientePorId CasoDeUsoBuscarClientePorId

@attribute [Authorize(Roles = "Gerente,Empleado")]

<div class="container mt-4">
    <div class="card shadow p-4">
        <h2 class="text-center text-primary">
            <i class="fas fa-key"></i> Historial de Llaves
        </h2>
        <p class="text-center text-muted">
            Alquiler ID: <strong>@idAlquiler</strong> — Cliente: <strong>@cliente?.Correo</strong>
        </p>

        <div class="mt-4">
            <h4 class="text-success"><i class="fas fa-sign-in-alt"></i> Entregas</h4>
            @if (listaEntrega != null && listaEntrega.Any())
            {
                <table class="table table-striped table-hover text-center">
                    <thead class="table-light">
                        <tr>
                            <th>Personal ID</th>
                            <th>Correo Cliente</th>
                            <th>Fecha y Hora</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var registro in listaEntrega)
                        {
                            <tr>
                                <td>@registro.PersonalId</td>
                                <td>@cliente?.Correo</td>
                                <td>@registro.FechayHoraRegistro.ToString("dd/MM/yyyy HH:mm")</td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
            else
            {
                <p class="text-muted">No se han registrado entregas.</p>
            }
        </div>

        <div class="mt-5">
            <h4 class="text-warning"><i class="fas fa-sign-out-alt"></i> Devoluciones</h4>
            @if (listaDevolucion != null && listaDevolucion.Any())
            {
                <table class="table table-striped table-hover text-center">
                    <thead class="table-light">
                        <tr>
                            <th>Personal ID</th>
                            <th>Correo Cliente</th>
                            <th>Fecha y Hora</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var registro in listaDevolucion)
                        {
                            <tr>
                                <td>@registro.PersonalId</td>
                                <td>@cliente?.Correo</td>
                                <td>@registro.FechayHoraRegistro.ToString("dd/MM/yyyy HH:mm")</td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
            else
            {
                <p class="text-muted">Todavía no fue devuelta.</p>
            }
        </div>
    </div>
</div>

@code {
    [Parameter]
    public int idAlquiler { get; set; }
    [Parameter]
    public int idCliente { get; set; }

    private List<RegistroDeLlave>? listaEntrega;
    private List<RegistroDeLlave>? listaDevolucion;
    public Cliente? cliente;

    protected override void OnParametersSet()
    {
        listaEntrega = CasoDeUsoListarLlaves.Ejecutar(idAlquiler, true);
        listaDevolucion = CasoDeUsoListarLlaves.Ejecutar(idAlquiler, false);
        cliente = CasoDeUsoBuscarClientePorId.Ejecutar(idCliente);
    }
}
