@page "/registrarse"
@rendermode InteractiveServer
@inject NavigationManager Navegador
@inject CasoDeUsoAltaCliente casoDeUsoAltaCliente
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject ServicioEnviarEmail servicioEnviarEmail
@inject ValidadorUsuario validadorUsuario
@using BlazorDateRangePicker

<div class="container mt-5">
    <div class="card shadow-lg p-4">
        <h2 class="text-center text-primary">游닇 Registro de Nuevo Usuario</h2>
        <p class="text-center text-muted">Complete los siguientes campos para registrarse.</p>

        <div class="row g-3">
            <div class="col-md-6">
                <label class="fw-bold"><i class="fas fa-user"></i> Nombre</label>
                <input @bind="_cliente.Nombre" class="form-control form-control-lg" placeholder="Ingrese su nombre" />
            </div>

            <div class="col-md-6">
                <label class="fw-bold"><i class="fas fa-user"></i> Apellido</label>
                <input @bind="_cliente.Apellido" class="form-control form-control-lg" placeholder="Ingrese su apellido" />
            </div>

            <div class="col-md-6">
                <label class="fw-bold"><i class="fas fa-id-card"></i> DNI</label>
                <input type="number" @bind="_cliente.Dni" class="form-control form-control-lg" placeholder="Ingrese su DNI" />
            </div>

            <div class="col-md-6">
                <label class="fw-bold"><i class="fas fa-envelope"></i> Correo</label>
                <input @bind="_cliente.Correo" class="form-control form-control-lg" placeholder="Ingrese su correo electr칩nico" />
            </div>

            <div class="col-md-6">
                <label class="fw-bold"><i class="fas fa-lock"></i> Contrase침a</label>
                    <input @bind="_cliente.Contrase침a" type="password" class="form-control form-control-lg" placeholder="Ingrese su contrase침a" />
            </div>

            <div class="col-md-6">
                <label class="fw-bold"><i class="fas fa-map-marker-alt"></i> Direcci칩n</label>
                <input @bind="_cliente.Direccion" class="form-control form-control-lg" placeholder="Ingrese su direcci칩n" />
            </div>

            <div class="col-md-6">
                <label class="fw-bold"><i class="fas fa-calendar-alt"></i> Fecha de Nacimiento</label>
                <div class="border rounded p-2">
                    <DateRangePicker @bind-EndDate="selectedDate" MinDate="minDate"
                        MaxDate="DateTime.Now" SingleDatePicker="true" />
                </div>
            </div>
        </div>

        <div class="text-center mt-4">
            <button class="btn btn-lg btn-success w-50" @onclick="Aceptar">
                <i class="fas fa-check"></i> Registrarse
            </button>
        </div>

        @foreach (var error in errores)
        {
            <div class="alert alert-danger mt-3 text-center">@error</div>
        }
    </div>
</div>

@code {
    private Cliente _cliente = new Cliente();
    private DateTimeOffset? selectedDate;
    private DateTime minDate = new DateTime(DateTime.Now.Year - 100, 1, 1);
    private List<string> errores = [];

    private void Aceptar()
    {
        errores.Clear();
        if (selectedDate == null)
        {
            errores = validadorUsuario.Ejecutar(_cliente);
            errores.Add("Por favor, seleccion치 una fecha de nacimiento.");
            return;
        }

        _cliente.FechaNacimiento = selectedDate.Value.DateTime;

        if (casoDeUsoAltaCliente.Ejecutar(_cliente, out errores))
            Navegador.NavigateTo("/?mensaje=Cliente registrado correctamente");
    }
}